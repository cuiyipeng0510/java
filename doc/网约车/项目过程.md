

#### 1. 启动

#### 可行性分析

#### 计划阶段

1. 进度安排，资源计划，成本估计，质量保证计划，
   - 预计计划怎么都完不成，怎么办
   - （1. 加班，2. 加人，加资源，3. 功能优先级，重要的先做，保证功能可用，遗留后续加紧迭代）

#### 项目和产品

1. 矩阵式，项目组



### 项目中职责

- 组长：接口定义，工程结构设计，代码review，各方沟通（产品，测试）核心功能开发
- 组员：具体开发实现，核心功能开发
- Kick Off 各方参与，齐聚启动会 --- 撕逼大会





## 微服务设计原则

架构，模式，拆分，隔离。  **目标：** **隔离系统的变化点**

### 具体原则

高内聚：功能模块集中，职责单一

低耦合：互不影响，影响小

高度自治：开发，测色hi，构建，部署，运行，发布。（不依赖，干扰其他服务 --- 无状态）---- 可插拔

以业务为i中心 --- 每个服务有特定的业务逻辑

弹性设计 （容错，隔离，降级）

自动化，持续集成，持续交付。

粒度把控：没有标准，任何一个服务，不要应为自己的开发，维护，影响其他服务

api组 业务层，service组 能力层

## AFK：

X轴：水平复制。 A A A A

Y轴：A

Z轴：数据分片：手机，衣服，家电。指定搜索范围



业务架构图：

技术架构图：

### 服务拆分：

#### 业务层

| 模块     | 项目名           | 描述     |
| -------- | ---------------- | -------- |
| 乘客端   | api-passenger    | 乘客端   |
| 司机端   | api-driver       | 司机端   |
| 司机听单 | api-listen-order | 司机听单 |



#### 能力

| app升级      | service-app-update        |
| ------------ | ------------------------- |
| 订单         | service-order             |
| 派单         | service-order-dispatch    |
| 乘客用户管理 | serfvice-passenger-user   |
| 短信         | service-sms               |
| 计价         | service-valuation         |
| 验证码       | service-verification-code |
| 钱包         | service-wallet            |
| 支付         | service-payment           |



#### spring cloud基础

| 注册中心 | cloud-eureka            |
| -------- | ----------------------- |
| 配置中心 | cloud-config-server     |
| 网关     | cloud-zuul              |
| 熔断监控 | cloud-hystrux-dashboard |
| 健康检查 | cloud-admin             |
| 链路追踪 | cloud-zipkin-ui         |



#### 通用包

| 通用，工具路，统一异常，校验 | taxi-common |
| ---------------------------- | ----------- |
|                              |             |



#### 用到的技术点

boot cloud maven git mysql redis mq

第三方：

短信服务（阿里，腾讯，华信）

语音服务：隐私号，（乘客和司机订单匹配后，电话交流非正式号码），录音

文件服务（OSS）

地图 ：高德，

消息推送：极光，透传，通知。

支付：微信，支付宝。

航旅纵横：查航班

发表：百望云

前端：vue，android，ios

商务都来公司，跟我们做技术交流，我们也了解了他们的一些，技术情况，和我们业务结合是否匹配，开发易用，稳定。。。

预估了1500的用户量，

能力层：QPS（Queries-per-second） 2000（4g, 8core）， 有些 300 就可以了

```
每秒查询率（QPS，Queries-per-second）是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准
QPS（TPS）：每秒钟request/事务 数量
```



### 接口设计：

restful：风格。多种实现，

**重在 资源** 

- 协议：https， IOS只能用 https
- 域名：/restapi.yuming.com/
- 版本：v1
- 路径：/xxoo/xxoo (只包含名词)
- 动作：
  - post:  新建
  - put：修改 （修改后的全量数据）
  - patch：修改 （修改哪个，传哪个）
  - delete：删除
  - get：查询

#### 安全

1. CIA: 保密性， 完整性， 可用性（饭店桌子被恶意占领，正常业务无法进行）
2. 数据层面： sql 注入， 过滤 jsoup 框架
   1. jsoup里防止 xss  whitelist(白名单) 有6中方法，一个构造，5中静态

```
select * form table where name = {变量; delete table}
$ 直接拼接，  #{} 替换
```

3. xss： 正常用户请求中执行了何可提供的恶意代码，问题出在： 用户数据没有过滤，转义

   csrf：人机交互，token

   冒充白人登陆信息： 没有防范不信任调用

   referer

4. 数据权限控制 (水平越权)































